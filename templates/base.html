<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}Quiz Fisica{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="theme-dark">
  
  <canvas id="backgroundCanvas"></canvas>

  <div class="page">
    <header class="site-header">
      <div class="site-header-inner">
        <div>
          <h1 class="site-title">Quiz Universitario AI</h1>
          <p class="site-subtitle">Creato da Adam Khiraoui</p>
        </div>
        <button type="button" class="theme-toggle" onclick="toggleTheme()">
          Tema chiaro/scuro
        </button>
      </div>
    </header>

    <main class="site-main">
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="flash-container">
            {% for msg in messages %}
              <div class="flash-message">{{ msg }}</div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      {% block content %}{% endblock %}
    </main>

    <footer class="site-footer">
      <p>Powered by Google Gemini AI</p>
    </footer>
  </div>

  <script>
    // --- LOGICA TEMA ---
    function applySavedTheme() {
      const saved = localStorage.getItem("quiz_theme");
      const body = document.body;
      if (saved === "light") {
        body.classList.remove("theme-dark");
        body.classList.add("theme-light");
      } else {
        body.classList.remove("theme-light");
        body.classList.add("theme-dark");
      }
    }

    function toggleTheme() {
      const body = document.body;
      if (body.classList.contains("theme-dark")) {
        body.classList.remove("theme-dark");
        body.classList.add("theme-light");
        localStorage.setItem("quiz_theme", "light");
      } else {
        body.classList.remove("theme-light");
        body.classList.add("theme-dark");
        localStorage.setItem("quiz_theme", "dark");
      }
    }
    applySavedTheme();

    // --- FLOATING LINES ANIMATION (Vanilla JS Port) ---
    (function() {
        const canvas = document.getElementById('backgroundCanvas');
        const ctx = canvas.getContext('2d');
        
        let width, height;
        let lines = [];
        
        // Configurazione dell'effetto
        const config = {
            lineCount: 40,       // Numero di linee
            minSpeed: 0.2,       // Velocità minima
            maxSpeed: 1.5,       // Velocità massima
            minWidth: 1,         // Spessore minimo
            maxWidth: 3,         // Spessore massimo
            colors: [            // Palette colori (toni blu/verdi/viola eleganti)
                '#3b82f6', '#10b981', '#8b5cf6', '#06b6d4', '#6366f1'
            ]
        };

        class Line {
            constructor() {
                this.init();
            }

            init(firstRun = false) {
                // Posizione X casuale
                this.x = Math.random() * width;
                
                // Se è il primo avvio, distribuisci le linee su tutto lo schermo verticalmente
                // Altrimenti, falle partire da sotto lo schermo
                if (firstRun) {
                    this.y = Math.random() * height;
                } else {
                    this.y = height + Math.random() * 200; // Parte sotto
                }

                // Lunghezza casuale della linea
                this.length = Math.random() * 150 + 50; 
                
                // Velocità casuale
                this.speed = Math.random() * (config.maxSpeed - config.minSpeed) + config.minSpeed;
                
                // Spessore
                this.width = Math.random() * (config.maxWidth - config.minWidth) + config.minWidth;
                
                // Colore casuale dalla palette
                this.color = config.colors[Math.floor(Math.random() * config.colors.length)];
                
                // Opacità casuale
                this.opacity = Math.random() * 0.5 + 0.1;
            }

            draw() {
                // Adatta l'opacità al tema (più trasparenti in light mode per non disturbare)
                const isDark = document.body.classList.contains('theme-dark');
                const finalOpacity = isDark ? this.opacity : this.opacity * 0.6;

                ctx.globalAlpha = finalOpacity;
                ctx.fillStyle = this.color;
                
                // Disegna la linea
                ctx.fillRect(this.x, this.y, this.width, this.length);
                ctx.globalAlpha = 1.0; // Reset opacità
            }

            update() {
                this.y -= this.speed; // Muove verso l'alto

                // Se la linea è uscita completamente dallo schermo in alto
                if (this.y + this.length < 0) {
                    this.init(); // Ricicla la linea riposizionandola sotto
                }
            }
        }

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }

        function initLines() {
            lines = [];
            for (let i = 0; i < config.lineCount; i++) {
                const line = new Line();
                line.init(true); // true = distribuisci inizialmente sullo schermo
                lines.push(line);
            }
        }

        function animate() {
            // Pulisce il canvas (il colore di fondo è gestito dal CSS)
            ctx.clearRect(0, 0, width, height);
            
            for (let line of lines) {
                line.draw();
                line.update();
            }
            requestAnimationFrame(animate);
        }

        // Event Listeners
        window.addEventListener('resize', () => {
            resize();
            initLines(); // Ricrea le linee se si ridimensiona la finestra
        });

        // Avvio
        resize();
        initLines();
        animate();
    })();
  </script>
</body>
</html>
